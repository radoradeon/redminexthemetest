!function(){"use strict";const e=`${window.location.host}_settings_user_${userId}`,t=e=>{const t=JSON.parse(localStorage.getItem(e));if(!t)return;const n=Object.keys(t);for(let e=0;e<n.length;e++){Date.now()-t[n[e]].timestamp>7776e6&&delete t[n[e]]}localStorage.setItem(e,JSON.stringify(t))},n=()=>{const n=$("#projects_list tr.project.parent td.name span");let i=JSON.parse(localStorage.getItem(e));i||(i={}),n.each(((t,n)=>{const a=$('<a class="parent-trigger" href="javascript:void(0)"><i class="fal fa fa-minus-square"></i></a>').insertBefore(n);a.click(o);const r=$(n).find("a").attr("href"),l=`favorite_project_${/[^/]*$/.exec(r)[0]}`;null!=i[l]?(i[l].timestamp=Date.now(),localStorage.setItem(e,JSON.stringify(i)),i[l].val||s(a)):s(a)})),t(e)},o=t=>{s(t.target);let n=JSON.parse(localStorage.getItem(e));n||(n={});const o=$(t.target).closest("a"),i=o.next().find("a").attr("href"),a=`favorite_project_${/[^/]*$/.exec(i)[0]}`;o.find("i").hasClass("fa-plus-square")?n[a]={val:!1,timestamp:Date.now()}:n[a]={val:!0,timestamp:Date.now()},localStorage.setItem(e,JSON.stringify(n))},s=e=>{const t=$(e);let n=t;t.is("i")||(n=t.find("i")),n.hasClass("fa-plus-square")?(n.removeClass("fa-plus-square"),n.addClass("fa-minus-square")):(n.removeClass("fa-minus-square"),n.addClass("fa-plus-square"));const o=n.closest("tr"),s=n.closest("tr").nextUntil("tr.project.root");if(n.hasClass("fa-plus-square"))for(let e=0;e<s.length&&!(i(o,$(s[e]))>=0);e++)$(s[e]).addClass("collapsed");else{let e=null;for(let t=0;t<s.length&&!(i(o,$(s[t]))>=0);t++)(!e||i(e,$(s[t]))>=0)&&($(s[t]).removeClass("collapsed"),e=null),e||!$(s[t]).find("i").hasClass("fa-plus-square")||(e=$(s[t]),$(s[t]).removeClass("collapsed"))}},i=(e,t)=>{if(!e||!t)return!1;let n=0,o=0;return e.hasClass("idnt")&&(n=parseInt(e.attr("class").match(/idnt-\d/)[0].split("-")[1])),t.hasClass("idnt")&&(o=parseInt(t.attr("class").match(/idnt-\d/)[0].split("-")[1])),n>o?1:n<o?-1:0},a=()=>{r(),l()},r=()=>{if(!window.rememberCollapsedIssuesState)return;const n=$("span.expander.icon.issue-group");if(n.length<=0)return;const o=JSON.parse(localStorage.getItem(e));o&&(n.each((t=>{if(null!=o[`issue_group_${$(n[t]).attr("id")}`]&&(o[`issue_group_${$(n[t]).attr("id")}`].timestamp=Date.now(),localStorage.setItem(e,JSON.stringify(o)),o[`issue_group_${$(n[t]).attr("id")}`].val)){const e=$(n[t]).parents("tr").first();let o=e.next();for(e.toggleClass("open"),$(n[t]).toggleClass("icon-expended icon-collapsed");o.length&&!o.hasClass("group");)o.toggle(),o=o.next("tr")}})),t(e))},l=()=>{if(!document.querySelector("div.attachments table"))return;const e=document.querySelector("div.attachments table"),t=document.querySelector("div.attachments table tbody");if(t.children.length<=7)return;const n=document.createElement("tbody"),o=document.createElement("tbody");o.classList.add("other-attachments");const s=document.createElement("tbody");s.innerHTML='<td colspan="10" class="attachments-btn-box"><button class="attachments-btn" onclick="uxu.issues.toggleAttachments(event)">'+I18nUxUpgradeJs.openAttachmentsBtn+"</button></td>",t.remove();for(let e=0;e<7;e++)n.appendChild(t.children[0]);for(;t.children.length>0;)o.appendChild(t.children[0]);e.appendChild(n),e.appendChild(o),e.appendChild(s)};var c=Object.freeze({__proto__:null,init:a,toggleRowGroupProjectino:t=>{const n=$(t).parents("tr").first();let o=n.next();for(n.toggleClass("open"),$(t).toggleClass("icon-expended icon-collapsed");o.length&&!o.hasClass("group");)o.toggle(),o=o.next("tr");let s=JSON.parse(localStorage.getItem(e));s||(s={}),n.hasClass("open")?s[`issue_group_${$(t).attr("id")}`]={val:!1,timestamp:Date.now()}:s[`issue_group_${$(t).attr("id")}`]={val:!0,timestamp:Date.now()},window.rememberCollapsedIssuesState&&localStorage.setItem(e,JSON.stringify(s))},toggleAllRowGroupsProjectino:t=>{const n=$(t).parents("tr").first(),o=$("span.expander.icon.issue-group");if(o.length<=0)return;let s=JSON.parse(localStorage.getItem(e));s||(s={}),n.hasClass("open")?(collapseAllRowGroups(t),o.each((e=>{s[`issue_group_${$(o[e]).attr("id")}`]={val:!0,timestamp:Date.now()}}))):(expandAllRowGroups(t),o.each((e=>{s[`issue_group_${$(o[e]).attr("id")}`]={val:!1,timestamp:Date.now()}}))),window.rememberCollapsedIssuesState&&localStorage.setItem(e,JSON.stringify(s))},toggleAttachments:e=>{const t=document.querySelector("tbody.other-attachments");t.classList.contains("open")?e.target.innerText=I18nUxUpgradeJs.openAttachmentsBtn:e.target.innerText=I18nUxUpgradeJs.closeAttachmentsBtn,t.classList.toggle("open")}});var d=Object.freeze({__proto__:null,toggleNewObjectDropdown:()=>{const e=$("#new-object + ul.menu-children");e.hasClass("visible")?e.removeClass("visible"):e.addClass("visible")}});const u=()=>{m(),$("div.mypage-box a.icon-only.icon-close").click(_)},m=()=>{const n=$("span.icon-collapse");if(n.length<=0)return;const o=JSON.parse(localStorage.getItem(e));o&&(n.each((t=>{const s=$(n[t]).closest("div.mypage-box");null!=o[`mybox_${s.attr("id")}`]&&(o[`mybox_${s.attr("id")}`].timestamp=Date.now(),localStorage.setItem(e,JSON.stringify(o)),o[`mybox_${s.attr("id")}`].val&&($(n[t]).addClass("collapsed"),s.addClass("mypage-box-collapsed")))})),t(e))},_=()=>confirm(I18nUxUpgradeJs.areYouSure);var f=Object.freeze({__proto__:null,init:u,myPageBlockToggle:t=>{const n=$(t),o=n.closest("div.mypage-box");let s=JSON.parse(localStorage.getItem(e));s||(s={}),n.hasClass("collapsed")?(n.removeClass("collapsed"),o.removeClass("mypage-box-collapsed"),s[`mybox_${o.attr("id")}`]={val:!1,timestamp:Date.now()}):(n.addClass("collapsed"),o.addClass("mypage-box-collapsed"),s[`mybox_${o.attr("id")}`]={val:!0,timestamp:Date.now()}),localStorage.setItem(e,JSON.stringify(s))}});const g=["#issue_project_id","#issue_status_id","#issue_priority_id","#issue_assigned_to_id","#issue_tracker_id","#time_entry_activity_id","#settings_issuequery_query_id","#time_entry_project_id","#project_default_version_id","#project_default_assigned_to_id","#version_status","#issue_category_assigned_to_id","#repository_scm","#status","#user_language","#pref_time_zone","#pref_comments_sorting","#pref_textarea_font","#pref_history_default_tab","#user_mail_notification","#role_issues_visibility","#role_time_entries_visibility","#role_users_visibility","#tracker_default_status_id","#copy_workflow_from","#role_id","#tracker_id","#settings_ui_theme","#settings_default_language","#settings_start_of_week","#settings_date_format","#settings_user_format","#settings_gravatar_default","#settings_protocol","#settings_text_formatting","#settings_wiki_compression","#settings_time_format","#settings_timespan_format","#settings_new_item_menu_tab","#settings_login_required","#settings_autologin","#settings_self_registration","#settings_password_max_age","#settings_twofa","#settings_session_lifetime","#settings_session_timeout","#settings_new_project_user_role_id","#settings_default_notification_option","#settings_default_users_time_zone","#settings_link_copied_issue","#settings_cross_project_subtasks","#settings_issue_done_ratio","#settings_parent_issue_dates","#settings_parent_issue_priority","#settings_parent_issue_done_ratio","#settings_mail_handler_preferred_body_part","#project_parent_id","#user_id","#group_by","#time_entry_user_id","#project_id","#document_category_id","#auth_source_ldap_mode",".controller-settings.action-plugin #settings select"],p=()=>{g.forEach((e=>{const t=$(e);t.length>0&&t.each(((e,t)=>{if("select"===$(t).prop("tagName").toLowerCase()&&!$(t).attr("multiple"))try{$(t).select2()}catch{}}))}))},h=()=>{var e=w(),t=[{element:"#sidebar",content:'<a id="hide-sidebar" href="#"><span class="far fa fa-plus"></span></a>',insert:"inner",if:!e.exists("#sidebarHandler")},{element:".controller-calendars.action-show table.cal, .controller-my.action-page table.cal, .controller-my.action-page table.time-entries, .controller-issues.action-show .issue table.list, .controller-issues.action-show .attachments table",content:'<div class="autoscroll"></div>',insert:"wrap",if:!0},{element:".controller-favorite_projects .filters #query_form fieldset",content:'<div id="query_form_with_buttons"><div id="query_form_content"></div></div>',insert:"wrapAll",if:!0},{element:".controller-issues.action-index #content > .contextual > a:first-of-type, .controller-timelog.action-index  #content > .contextual > a:first-of-type, .controller-agile_versions.action-index #content > .contextual > a:first-of-type, .controller-risks.action-index #content > .contextual > a:first-of-type, .controller-agile_boards.action-index #content > .contextual > a:first-of-type, .controller-contacts.action-index #content > .contextual > a:first-of-type, .controller-deals.action-index #content > .contextual > a:first-of-type, .controller-expenses.action-index #content > .contextual > a:first-of-type, .controller-invoices.action-index #content > .contextual > a:first-of-type, .controller-resource_bookings.action-index #content > .contextual > a:first-of-type, .controller-easy_gantt.action-index #easy_gantt > .contextual > a:first-of-type, .controller-easy_gantt_resources.action-index #easy_gantt > .contextual > a:first-of-type, .controller-dmsf.action-show #content > .contextual > a:first-of-type, .controller-redmine_x_project_templates.action-index #content > .contextual > a:first-of-type",content:'<a class="toggle-filters" id="show-filters"><i class="far fa fa-filter"></i> <span>'+toggleFilters+"</span></a>",insert:"before",if:!0},{element:".controller-calendars.action-show #content > h2, .controller-calendar.action-index #content > h2, .controller-operations.action-index #content > h2",content:'<div class="contextual"><a class="toggle-filters" id="show-filters"><i class="far fa fa-filter"></i> <span>'+toggleFilters+"</span></a></div>",insert:"before",if:!0},{element:".controller-gantts.action-show #content > .contextual",content:'<a class="toggle-filters" id="show-filters"><i class="far fa fa-filter"></i> <span>'+toggleFilters+"</span></a>",insert:"inner",if:!0},{element:".controller-favorite_projects.action-search #content > .contextual > a:last-of-type",content:'<a class="toggle-filters" id="show-filters"><i class="far fa fa-filter"></i> <span>'+toggleFilters+"</span></a>",insert:"after",if:!0},{element:"#footer",content:'<span>&nbsp;&nbsp;|&nbsp;&nbsp; Upgraded by <a  href="http://www.redmine-x.com" target="_blank" property="RedmineX">RedmineX</a>',insert:"inner",if:!0}],n=[{element:"#history",class:"issue-changesets-exist",type:"add",if:e.exists("#issue-changesets")},{element:"body",class:"controller-helpdesk",type:"add",if:e.exists("#ticket_data")},{element:".flyout-menu__avatar .user",class:"hidden",type:"add",if:e.exists(".flyout-menu__avatar .gravatar")},{element:"#account",class:"unlogged",type:"add",if:!e.exists("#loggedas")},{element:"ul.projects li:has(.parent:not(.child))",class:"collapsible collapsed",type:"add",if:!0}],o=[{element:"#hide-sidebar",action:function(){$("#sidebar").toggleClass("d-none"),$("#content").toggleClass("full")},if:!e.exists("#sidebarHandler")},{element:"#top-menu-hamburger-trigger",action:function(){$("#top-menu-hamburger").toggleClass("open"),$("#top-menu-hamburger-trigger").toggleClass("open")},if:!0},{element:"#new-entity",action:function(){$("#new-entity").toggleClass("rotate45"),$("#actionbar .menu-children").toggleClass("open")},if:!0},{element:"#expanded-menu",action:function(){$("#expanded-menu-items").toggleClass("visible")},if:!0},{element:"#show-issue-changesets",action:function(){$("#issue-changesets").slideToggle("fast")},if:!0},{element:"ul.projects li:has(.parent:not(.child))",action:function(){$(this).toggleClass("collapsed"),$(this).find("ul").toggle()},onInit:hideSubProjectsAsDefault,if:!0},{element:"#show-filters",action:function(){$(".controller-issues.action-index #query_form_with_buttons, .controller-timelog.action-index #query_form_with_buttons, .controller-gantts.action-show #query_form_with_buttons, .controller-calendars.action-show #query_form_with_buttons, .controller-easy_gantt.action-index #query_form_with_buttons, .controller-agile_versions.action-index #query_form_with_buttons, .controller-risks.action-index #query_form_with_buttons, .controller-agile_boards.action-index #query_form_with_buttons, .controller-contacts.action-index #query_form_with_buttons, .controller-deals.action-index #query_form_with_buttons, .controller-expenses.action-index #query_form, .controller-invoices.action-index #query_form, .controller-resource_bookings.action-index #query_form_with_buttons, .controller-easy_gantt_resources.action-index #query_form_with_buttons, .controller-easy_gantt_resources.action-index #query_form_with_buttons, .controller-calendar.action-index #calendar_filter, .controller-operations.action-index #query_form, .controller-dmsf.action-show #query_form, .controller-favorite_projects.action-search #query_form, .controller-redmine_x_project_templates.action-index #query_form_with_buttons").toggleClass("open")},if:!0},{element:"div#content div.issue",action:function(e){var t=$(e.target);t.is("div.wiki i.fa.fa-pencil.dynamicEditIcon.fa-fw")?$("div.description div.wiki").addClass("value edited"):(t.is("div.wiki.value")||t.is("div.wiki.value span.showValue")||t.is("div.wiki.value p"))&&$("div.wiki.value").removeClass("value")},if:!0},{element:"#issue-action-dropdown-trigger",action:function(){$("#issue-action-dropdown").toggleClass("open")},if:!0},{element:"#all_attributes",action:function(e){($("#projectino-addtitional-fields-trigger").is(e.target)||$("#projectino-addtitional-fields-trigger span").is(e.target)||$("#projectino-addtitional-fields-trigger i").is(e.target))&&($("#projectino-addtitional-fields-trigger").toggleClass("open"),$(".projectino-addtitional-fields-wrap").toggleClass("open"))},if:!0},{element:document,action:function(e){const t=$(e.target);t.closest("#top-menu-hamburger-trigger").length<1&&t.closest("#top-menu-hamburger").length<1&&($("#top-menu-hamburger-trigger").removeClass("open"),$("#top-menu-hamburger").removeClass("open")),t.closest("#new-entity").length<1&&t.closest("#actionbar .menu-children").length<1&&($("#new-entity").removeClass("rotate45"),$("#actionbar .menu-children").removeClass("open")),t.closest("#issue-action-dropdown-trigger").length<1&&t.closest("#issue-action-dropdown").length<1&&$("#issue-action-dropdown").removeClass("open"),t.closest("#new-object").length<1&&t.closest("#new-object + ul.menu-children").length<1&&$("#new-object + ul.menu-children").removeClass("visible"),t.closest("#expanded-menu").length<1&&t.closest("#expanded-menu-items").length<1&&$("#expanded-menu-items").removeClass("visible")},if:!0},{element:"p#issue_description_edit a",action:function(e){$("p#issue_description_edit").addClass("edit-open")},if:!$("p#issue_description_edit").hasClass("edit-open")}];e.run(t,n,[],o,"#show-issue-changesets",""),"yes"===hostingDemoRedmine&&$("#main").append('<div id="buy-theme"><a target="_blank" href="https://www.abacusthemes.com/en/pricing">Get Theme</a></div>')},w=()=>{function e(){return[$("#issue-form").length&&$("#issue-form"),$("#new_project").length&&$("#new_project"),$("[id^=edit_project_]").length&&$("[id^=edit_project_]"),$("#new_document").length&&$("#new_document"),$("[id^=edit_document_]").length&&$("[id^=edit_document_]"),$("#wiki_form").length&&$("#wiki_form"),$("#news-form").length&&$("#news-form"),$("#add_comment_form").not('[style*="none"]').length&&$("#add_comment_form"),$("#tab-content-avatar div.box").length&&$("#tab-content-avatar div.box"),$("[id^=tab-content-]").not('[style*="none"]').not("#tab-content-avatar").find("form").length&&$("[id^=tab-content-]").not('[style*="none"]').not("#tab-content-avatar").find("form"),$("#my_account_form").length&&$("#my_account_form"),$("#new_time_entry").length&&$("#new_time_entry"),$("#settings form").length&&$("#settings form"),$("#query-form").length&&$("#query-form"),$("#workflow_form").length&&$("#workflow_form"),$("#new_issue_status").length&&$("#new_issue_status"),$('form[id^="edit_issue_status_"]').length&&$('form[id^="edit_issue_status_"]'),$('form[action="'+redmineRelativePath+'/custom_fields/new"]').length&&$('form[action="'+redmineRelativePath+'/custom_fields/new"]'),$("#custom_field_form").length&&$("#custom_field_form"),$("#new_enumeration").length&&$("#new_enumeration"),$("#edit_enumeration").length&&$("#edit_enumeration"),$("#auth_source_form").length&&$("#auth_source_form"),$("#new_tracker").length&&$("#new_tracker"),$('form[id^="edit_tracker_"]').length&&$('form[id^="edit_tracker_"]'),$('form[action="'+redmineRelativePath+'/trackers/fields"]').length&&$('form[action="'+redmineRelativePath+'/trackers/fields"]'),$("#new_role").length&&$("#new_role"),$('form[id^="edit_role_"]').length&&$('form[id^="edit_role_"]'),$("#new_group").length&&$("#new_group"),$('form[id^="edit_group_"]').length&&$('form[id^="edit_group_"]'),$("#new_user").length&&$("#new_user"),$("#permissions_form").length&&$("#permissions_form")].filter(Boolean)}function t(){const t=e();let o,s;for(let e=0;e<t.length;e++)o=t[e].offset().top+t[e].outerHeight()-window.innerHeight,s=t[e].offset().top-window.innerHeight,(s>=$(window).scrollTop()||$(window).scrollTop()>=o+n(3))&&t[e].find(".projectino-controls").addClass("release"),s<$(window).scrollTop()&&$(window).scrollTop()<o-t[e].find(".projectino-controls").outerHeight()+n(1.2)&&t[e].find(".projectino-controls").removeClass("release")}function n(e){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)}return{run:function(o,s,i,a,r,l){return function(e){e.filter((function(e){return!0===e.if})).forEach((function(e){"inner"===e.insert&&$(e.element).append(e.content),"before"===e.insert&&$(e.element).before(e.content),"after"===e.insert&&$(e.element).after(e.content),"wrap"===e.insert&&$(e.element).wrap(e.content),"wrapAll"===e.insert&&$(e.element).wrapAll(e.content),"wrapInner"===e.insert&&$(e.element).wrapInner(e.content)}))}(o),function(e){e.filter((function(e){return!0===e.if})).forEach((function(e){"add"===e.type&&$(e.element).addClass(e.class)}))}(s),function(e){e.forEach((function(e){$(e.element).attr(e.attrName,e.attrValue)}))}(i),function(e){e.forEach((function(e){e.if&&$(e.element).click(e.action),e.if&&e.onInit&&setTimeout((function(){$(e.element).trigger("click")}),0)}))}(a),$(r).click((function(){$(this).toggleClass("fa-plus-square").toggleClass("fa-minus-square")})),function(e){$(e).hide()}(l),function(){var e=!1,t=!1;function n(){var n=function(){var e=$("#main-menu2 > ul:not(.menu-children)"),t=$("#main-menu2 > ul:not(.menu-children) > li"),n=$("#expanded-menu-items > li"),o=e.innerWidth()-e.width()+3;return t.each((function(){o+=$(this).outerWidth(!0)})),n.each((function(){o+=$(this).outerWidth(!0)})),o},o=function(){e||($("#project-jump").detach().prependTo(".flyout-menu__search"),$("#top-menu-hamburger").detach().appendTo(".flyout-menu"),$("#expanded-menu").addClass("hidden"),$("#expanded-menu-items").removeClass("menu-children"),$("#main-menu2 > ul:not(.menu-children)").css("width",`${n()}px`),e=!0,t=!1)},s=function(){t||($("#project-jump").detach().appendTo("#quick-search"),$("#top-menu-hamburger").detach().insertAfter("#top-menu-hamburger-trigger"),$("#expanded-menu").removeClass("hidden"),$("#expanded-menu-items").addClass("menu-children"),$("#main-menu2 > ul:not(.menu-children)").css("width",""),t=!0,e=!1)};isMobile()?o():s()}$(window).resize((function(){n()})),n()}(),e().length&&(t(),$(".tabs a[id^=tab-]").bind("click",t),$("div.contextual a.icon-edit").bind("click",t),$("form#workflow_form fieldset legend").bind("click",t),$(window).bind("scroll",(function(){const t=e();let o,s;for(let e=0;e<t.length;e++)o=t[e].offset().top+t[e].outerHeight()-window.innerHeight,s=t[e].offset().top-window.innerHeight,(s>=$(window).scrollTop()||$(window).scrollTop()>=o+n(3))&&t[e].find(".projectino-controls").addClass("release"),s<$(window).scrollTop()&&$(window).scrollTop()<o-t[e].find(".projectino-controls").outerHeight()+n(1.2)&&t[e].find(".projectino-controls").removeClass("release")}))),setTimeout((function(){$("#chat-application").addClass("d-block")}),1e4),!1},exists:function(e){return 0!==$(e).length}}};document.addEventListener("DOMContentLoaded",(()=>{window.uxu={issues:c,menu:d,myPage:f},n(),a(),u(),p(),window.hideSubProjectsAsDefault=!0,window.showLogoLogin=!0,window.toggleFilters=I18nUxUpgradeJs.filtersAndOptions,window.templateFolderName="redminex_theme",window.removeSystemJQueryAddTemplateJQuery="no",window.customMenuPlugin="yes",window.hostingDemoRedmine="no",window.removeRedmineResponsiveScripts="yes",window.removeDuplicateIds="no",$("head").append('<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">'),h()}))}();
